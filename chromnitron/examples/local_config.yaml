# This yaml file includes 3 sections:
# 1. Model weights: path to the model resource, including base model weights and fine-tuned CAP model weights.
# 2. Input resources: path to input data, including DNA sequence, ATAC-seq, and protein embeddings.
# 3. Inference configuration: configuration for the inference process.

# Model weights paths
model_resource:
  root: /broad/boxialab/sihengtao/chromnitron/resources/model_weights
  base_weights: chromnitron_base.pt
  per_cap_lora_weights: CAPs

# Input resources paths
input_resource:
  # DNA sequence and CAP embeddings are usually static; keep them under a shared root.
  root: /broad/boxialab/sihengtao/chromnitron/resources/input_resources
  sequence: DNA_sequence # <assembly_name>.fa or <assembly_name>.zarr (+ <assembly_name>.chrom.sizes if using zarr)
  cap: CAP_embeddings # <CAP_name>.npz embeddings generated by SeqToVec from protein FASTA

  # ATAC tracks are re-run and may live elsewhere (e.g., chrom2vec outputs per project).
  atac_root: /broad/boxialab/sihengtao/projects/30-vs70+atac_clock_pilot/chrom2vec_output

# Option A: sample folders live directly under atac_root (leave empty)
  atac: '' # optional subfolder under atac_root
  # Pattern supports {sample} placeholder; can include subdirectories. {sample} comes from celltype_list.txt entries.
  atac_pattern: "{sample}/s8_normalized/genrich_normalized.zarr" # e.g., <atac_root>/<sample>/s8_normalized/genrich_normalized.zarr
# Option B: uncomment below if all samples sit inside a shared subfolder (replace SUBDIR)
  # atac: SUBDIR
  # atac_pattern: "{sample}.zarr"



# Inference configuration: input and output paths. Regions, cell types, and CAPs of interest
inference_config: 
  input: 
    root: /broad/boxialab/sihengtao/chromnitron/chromnitron/examples/inputs
    assembly: hg38 # Assembly name, used to find chrom.sizes file
    excluded_region_path: auto # automatically determined by assembly and downloaded from Boyle lab, auto format: <assembly_name>-blacklist.v2.bed.
    locus_list_path: locus.bed # Bed file
    celltype_list_path: celltype.txt # Text file, one cell type per line according to atac-seq sample names
    cap_list_path: cap.txt # Text file, one CAP per line
  inference:
    enable: True
    use_finetune: auto # If auto, use finetuned model if available, otherwise use base model
    batch_size: 8 # Batch size for inference
    num_workers: 8 # Number of cpu workers for inference
  output: 
    path: /broad/boxialab/sihengtao/projects/30-vs70+atac_clock_pilot/chromnitron_output # Directory to save output files
    skip_if_exists: True # Skip inference/post-processing if output files exist
  post_processing:
    enable: True
    valid_margin: 1024 # Valid margin is removed from each side of the prediction to keep the prediction within the valid region
    store_bigwig: True # Whether to store bigwig files
    store_zarr: True # Whether to store zarr files
    peak_calling: True # Whether to call peaks
